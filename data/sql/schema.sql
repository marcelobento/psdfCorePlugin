CREATE TABLE psdfwf.activity (id BIGSERIAL, PRIMARY KEY(id));
CREATE TABLE psdfwf.catalogo (id BIGSERIAL, nombre VARCHAR(30) NOT NULL UNIQUE, definicion TEXT, PRIMARY KEY(id));
CREATE TABLE psdfwf.coordenada (id BIGSERIAL, nombre VARCHAR(30) NOT NULL UNIQUE, pxtop BIGINT, pxleft BIGINT, rel_picture BIGINT, rel_proceso BIGINT, PRIMARY KEY(id));
CREATE TABLE psdfwf.estado_flow (id BIGSERIAL, nombre VARCHAR(30) NOT NULL UNIQUE, descripcion VARCHAR(100), PRIMARY KEY(id));
CREATE TABLE psdfwf.flow (id BIGSERIAL, datafields TEXT, rel_estado BIGINT, rel_proceso BIGINT, PRIMARY KEY(id));
CREATE TABLE psdfwf.flow_det (id BIGSERIAL, activity_id VARCHAR(30) NOT NULL, rel_estado BIGINT, rel_flow BIGINT, rel_usuario BIGINT, tstart TIME, tend TIME, PRIMARY KEY(id));
CREATE TABLE psdfwf.macro (id BIGSERIAL, nombre VARCHAR(30) NOT NULL UNIQUE, rel_proyecto BIGINT, PRIMARY KEY(id));
CREATE TABLE psdforg.organizacion (id BIGSERIAL, nombre VARCHAR(30) NOT NULL UNIQUE, PRIMARY KEY(id));
CREATE TABLE psdfwf.paquete (id BIGSERIAL, nombre VARCHAR(30) NOT NULL UNIQUE, xpdl TEXT, rel_macro BIGINT, rel_paquete BIGINT, xpdl_id VARCHAR(30) UNIQUE, PRIMARY KEY(id));
CREATE TABLE psdfwf.picture (id BIGSERIAL, nombre VARCHAR(30) NOT NULL UNIQUE, rel_paquete BIGINT, PRIMARY KEY(id));
CREATE TABLE psdfwf.proceso (id BIGSERIAL, nombre VARCHAR(30) NOT NULL UNIQUE, rel_paquete BIGINT, imagen VARCHAR(30), xpdl_id VARCHAR(30) NOT NULL UNIQUE, PRIMARY KEY(id));
CREATE TABLE psdforg.proyecto (id BIGSERIAL, nombre VARCHAR(30) NOT NULL UNIQUE, rel_organizacion BIGINT, PRIMARY KEY(id));
CREATE TABLE psdforg.unidadorg (id BIGSERIAL, nombre VARCHAR(30) NOT NULL UNIQUE, rel_organizacion BIGINT, PRIMARY KEY(id));
CREATE TABLE psdforg.usuario (id BIGSERIAL, nombre VARCHAR(30) NOT NULL UNIQUE, pass VARCHAR(30) NOT NULL UNIQUE, PRIMARY KEY(id));
CREATE TABLE psdforg.usuorg (id BIGSERIAL, menu TEXT, state BOOLEAN DEFAULT 'true' NOT NULL, rel_organizacion BIGINT, rel_usuario BIGINT, rel_proceso BIGINT, PRIMARY KEY(id));
CREATE TABLE sf_guard_group (id SERIAL, name VARCHAR(255) UNIQUE, description VARCHAR(1000), created_at TIMESTAMP NOT NULL, updated_at TIMESTAMP NOT NULL, PRIMARY KEY(id));
CREATE TABLE sf_guard_group_permission (group_id INT, permission_id INT, created_at TIMESTAMP NOT NULL, updated_at TIMESTAMP NOT NULL, PRIMARY KEY(group_id, permission_id));
CREATE TABLE sf_guard_permission (id SERIAL, name VARCHAR(255) UNIQUE, description VARCHAR(1000), created_at TIMESTAMP NOT NULL, updated_at TIMESTAMP NOT NULL, PRIMARY KEY(id));
CREATE TABLE sf_guard_remember_key (id SERIAL, user_id INT, remember_key VARCHAR(32), ip_address VARCHAR(50), created_at TIMESTAMP NOT NULL, updated_at TIMESTAMP NOT NULL, PRIMARY KEY(id, ip_address));
CREATE TABLE sf_guard_user (id SERIAL, username VARCHAR(128) NOT NULL UNIQUE, algorithm VARCHAR(128) DEFAULT 'sha1' NOT NULL, salt VARCHAR(128), password VARCHAR(128), is_active BOOLEAN DEFAULT 'true', is_super_admin BOOLEAN DEFAULT 'false', last_login TIMESTAMP, created_at TIMESTAMP NOT NULL, updated_at TIMESTAMP NOT NULL, PRIMARY KEY(id));
CREATE TABLE sf_guard_user_group (user_id INT, group_id INT, created_at TIMESTAMP NOT NULL, updated_at TIMESTAMP NOT NULL, PRIMARY KEY(user_id, group_id));
CREATE TABLE sf_guard_user_permission (user_id INT, permission_id INT, created_at TIMESTAMP NOT NULL, updated_at TIMESTAMP NOT NULL, PRIMARY KEY(user_id, permission_id));
CREATE INDEX is_active_idx ON sf_guard_user (is_active);
ALTER TABLE psdfwf.coordenada ADD CONSTRAINT psdfwf_coordenada_rel_proceso_psdfwf_proceso_id FOREIGN KEY (rel_proceso) REFERENCES psdfwf.proceso(id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE psdfwf.coordenada ADD CONSTRAINT psdfwf_coordenada_rel_picture_psdfwf_picture_id FOREIGN KEY (rel_picture) REFERENCES psdfwf.picture(id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE psdfwf.flow ADD CONSTRAINT psdfwf_flow_rel_proceso_psdfwf_proceso_id FOREIGN KEY (rel_proceso) REFERENCES psdfwf.proceso(id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE psdfwf.flow_det ADD CONSTRAINT psdfwf_flow_det_rel_usuario_sf_guard_user_id FOREIGN KEY (rel_usuario) REFERENCES sf_guard_user(id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE psdfwf.flow_det ADD CONSTRAINT psdfwf_flow_det_rel_flow_psdfwf_flow_id FOREIGN KEY (rel_flow) REFERENCES psdfwf.flow(id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE psdfwf.macro ADD CONSTRAINT psdfwf_macro_rel_proyecto_psdforg_proyecto_id FOREIGN KEY (rel_proyecto) REFERENCES psdforg.proyecto(id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE psdfwf.paquete ADD CONSTRAINT psdfwf_paquete_rel_paquete_psdfwf_paquete_id FOREIGN KEY (rel_paquete) REFERENCES psdfwf.paquete(id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE psdfwf.paquete ADD CONSTRAINT psdfwf_paquete_rel_macro_psdfwf_macro_id FOREIGN KEY (rel_macro) REFERENCES psdfwf.macro(id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE psdfwf.picture ADD CONSTRAINT psdfwf_picture_rel_paquete_psdfwf_paquete_id FOREIGN KEY (rel_paquete) REFERENCES psdfwf.paquete(id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE psdfwf.proceso ADD CONSTRAINT psdfwf_proceso_rel_paquete_psdfwf_paquete_id FOREIGN KEY (rel_paquete) REFERENCES psdfwf.paquete(id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE psdforg.proyecto ADD CONSTRAINT psdforg_proyecto_rel_organizacion_psdforg_organizacion_id FOREIGN KEY (rel_organizacion) REFERENCES psdforg.organizacion(id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE psdforg.unidadorg ADD CONSTRAINT psdforg_unidadorg_rel_organizacion_psdforg_organizacion_id FOREIGN KEY (rel_organizacion) REFERENCES psdforg.organizacion(id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE psdforg.usuorg ADD CONSTRAINT psdforg_usuorg_rel_usuario_sf_guard_user_id FOREIGN KEY (rel_usuario) REFERENCES sf_guard_user(id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE psdforg.usuorg ADD CONSTRAINT psdforg_usuorg_rel_proceso_psdfwf_proceso_id FOREIGN KEY (rel_proceso) REFERENCES psdfwf.proceso(id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE psdforg.usuorg ADD CONSTRAINT psdforg_usuorg_rel_organizacion_psdforg_organizacion_id FOREIGN KEY (rel_organizacion) REFERENCES psdforg.organizacion(id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE sf_guard_group_permission ADD CONSTRAINT sf_guard_group_permission_permission_id_sf_guard_permission_id FOREIGN KEY (permission_id) REFERENCES sf_guard_permission(id) ON DELETE CASCADE NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE sf_guard_group_permission ADD CONSTRAINT sf_guard_group_permission_group_id_sf_guard_group_id FOREIGN KEY (group_id) REFERENCES sf_guard_group(id) ON DELETE CASCADE NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE sf_guard_remember_key ADD CONSTRAINT sf_guard_remember_key_user_id_sf_guard_user_id FOREIGN KEY (user_id) REFERENCES sf_guard_user(id) ON DELETE CASCADE NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE sf_guard_user_group ADD CONSTRAINT sf_guard_user_group_user_id_sf_guard_user_id FOREIGN KEY (user_id) REFERENCES sf_guard_user(id) ON DELETE CASCADE NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE sf_guard_user_group ADD CONSTRAINT sf_guard_user_group_group_id_sf_guard_group_id FOREIGN KEY (group_id) REFERENCES sf_guard_group(id) ON DELETE CASCADE NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE sf_guard_user_permission ADD CONSTRAINT sf_guard_user_permission_user_id_sf_guard_user_id FOREIGN KEY (user_id) REFERENCES sf_guard_user(id) ON DELETE CASCADE NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE sf_guard_user_permission ADD CONSTRAINT sf_guard_user_permission_permission_id_sf_guard_permission_id FOREIGN KEY (permission_id) REFERENCES sf_guard_permission(id) ON DELETE CASCADE NOT DEFERRABLE INITIALLY IMMEDIATE;
